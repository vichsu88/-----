{% extends "base.html" %}

{% block title %}承天中承府 - 收驚與問事服務{% endblock %}

{% block content %}
<style>
    /* 頁面專屬樣式 */
    .services-page-wrapper {
        padding: 40px 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* 頂部快速導覽按鈕列 */
    .service-anchor-nav {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 60px;
        position: sticky;
        top: 120px; /* 根據您的 header 高度調整，讓它吸附在 header 下方 */
        z-index: 90;
        padding: 10px 0;
        background: rgba(243, 240, 236, 0.9); /* 與背景色相同但微透明 */
        backdrop-filter: blur(5px);
    }

    .anchor-btn {
        padding: 12px 40px;
        font-size: 18px;
        border-radius: 30px;
        border: 2px solid #E6BA67;
        background-color: #fff;
        color: #C48945;
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .anchor-btn:hover, .anchor-btn.active {
        background-color: #E6BA67;
        color: #fff;
        transform: translateY(-2px);
    }

    /* 分隔線 */
    .section-divider {
        height: 4px;
        background: linear-gradient(90deg, transparent, #E6BA67, transparent);
        margin: 80px 0;
        border-radius: 2px;
        opacity: 0.5;
    }

    /* 以下沿用原本 shoujing 和 gongtan 的樣式 */
    .title-wrapper { text-align: center; margin-bottom: 40px; }
    
    /* 收驚卡片容器 (手機橫滑/電腦置中) */
    .process-card-container {
        display: flex; gap: 20px; overflow-x: auto; padding: 20px 10px;
        scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
    }
    .process-card {
        flex: 0 0 280px; scroll-snap-align: center;
        background: rgba(255, 255, 255, 0.7); border: 2px solid #E6BA67;
        border-radius: 15px; padding: 25px 20px;
        display: flex; flex-direction: column; alignItems: center; text-align: center;
        box-shadow: 0 4px 10px rgba(196, 137, 69, 0.15); transition: transform 0.3s ease;
    }
    .process-card:hover { transform: translateY(-5px); }
    .card-title { font-size: 1.3em; font-weight: bold; color: #C48945; margin-bottom: 10px; }
    .card-desc { font-size: 0.95em; color: #333; line-height: 1.5; margin-bottom: 15px; flex-grow: 1; }
    .card-image-box { width: 100%; height: 150px; background-color: #f0ebe5; border-radius: 10px; margin-bottom: 20px; overflow: hidden; display: flex; justify-content: center; align-items: center; }
    .card-image-box img { width: 100%; height: 100%; object-fit: cover; }
    .card-btn { width: 100%; }

    /* 公壇樣式 */
    .gongtan-process-wrapper {
        display: flex; justify-content: center; align-items: center; gap: 30px;
        max-width: 900px; margin: 0 auto; padding: 0 20px;
    }
    .gongtan-main-image-wrapper { flex: 0 0 160px; }
    .gongtan-main-image-wrapper img { width: 100%; height: auto; }
    .gongtan-process-steps { text-align: left; }
    .step-item-gongtan { margin-bottom: 25px; }
    .step-item-gongtan h3 { font-size: 20px; color: #C48945; margin: 0 0 8px 0; }
    .step-item-gongtan p { font-size: 16px; line-height: 1.7; margin: 0 0 12px 0; }
    .step-image { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; }

    /* RWD */
    @media (min-width: 1024px) {
        .process-card-container { justify-content: center; overflow-x: visible; max-width: 1000px; margin: 0 auto; }
        .process-card { flex: 1; max-width: 320px; }
    }
    @media (max-width: 768px) {
        .gongtan-process-wrapper { flex-direction: column; }
        .gongtan-main-image-wrapper { display: none; } /* 手機版隱藏公壇主圖以節省空間 */
        .service-anchor-nav { top: 80px; } /* 手機版 Header 較矮 */
    }

    /* Modal 樣式 */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; justify-content: center; align-items: center; display: none; backdrop-filter: blur(5px); }
    .modal-content { background: #fff; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; position: relative; border: 2px solid #E6BA67; }
    .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #C48945; border: 1px solid #D9B88A; border-radius: 50%; width: 35px; height: 35px; color: white; font-size: 20px; line-height: 35px; text-align: center; cursor: pointer; }
</style>

<main class="services-page-wrapper">
    
    <div class="service-anchor-nav">
        <a href="#shoujing-section" class="anchor-btn">收驚服務</a>
        <a href="#gongtan-section" class="anchor-btn">問事服務</a>
    </div>

    <div id="shoujing-section">
        <div class="title-wrapper">
            <h2 class="section-title">收驚流程</h2>
            <p style="text-align: center; max-width: 600px; margin: 0 auto 40px auto; color: #555; line-height: 1.6;">
                請依序完成以下三個步驟。
            </p>
        </div>

        <div class="process-card-container">
            <div class="process-card">
                <div class="card-title">步驟一：準備衣物</div>
                <div class="card-desc">準備一件輕薄衣物，並將個人資訊寫於紅紙後，夾帶於衣服中。<br> 每一件都要寫！</div>
                <div class="card-image-box">
                    <img src="{{ url_for('static', filename='images/pages/shoujing/card1.png') }}" alt="步驟一">
                </div>
                <button class="btn btn--brown card-btn" onclick="openStepModal(1)">填寫教學</button>
            </div>
            <div class="process-card">
                <div class="card-title">步驟二：寄送衣物</div>
                <div class="card-desc"><p>親送：衣物與資料親送至「八八菸酒」<br> 郵寄： 將衣物與資料一同郵寄至帥府。</p></div>
                <div class="card-image-box">
                    <img src="{{ url_for('static', filename='images/pages/shoujing/card2.png') }}" alt="步驟二">
                </div>
                <button class="btn btn--brown card-btn" onclick="openStepModal(2)">八八地址</button>
            </div>
            <div class="process-card">
                <div class="card-title">步驟三：領取</div>
                <div class="card-desc"><p>關注群組通知的收驚進度<br><strong>自取</strong>：依公告編號取回。<br><strong>寄回</strong>：自行安排到付快遞。</p></div>
                <div class="card-image-box">
                    <img src="{{ url_for('static', filename='images/pages/shoujing/card3.png') }}" alt="步驟三">
                </div>
                <button class="btn btn--brown card-btn" onclick="openStepModal(3)">黑貓下單教學</button>
            </div>
        </div>
    </div>

    <div class="section-divider"></div>

    <div id="gongtan-section">
        <div class="title-wrapper">
            <h2 class="section-title">公壇流程</h2>
        </div>
        <div class="gongtan-process-wrapper">
            <div class="gongtan-main-image-wrapper">
                 <img src="{{ url_for('static', filename='images/pages/gongtan/road-4.png') }}" alt="公壇流程圖">
            </div>
            <div class="gongtan-process-steps">
                <div class="step-item-gongtan">
                    <h3>報名公告</h3>
                    <p>加入 LINE 群組，關注下個月的公壇日期、報名日期及開放名額。<br>*每人限加1群違者踢群。</p>
                    <a href="{{ links['煙島元帥社群'] or '#' }}" class="btn btn--brown" target="_blank">加入LINE</a>
                </div>
                <div class="step-item-gongtan">
                    <h3>線上報名</h3>
                    <p>報名當日由小編發布「報名開始」後，需立即在群組留言「+1」，額滿即止。</p>
                    <img src="{{ url_for('static', filename='images/pages/gongtan/signuppic.jpg') }}" alt="線上報名範例" class="step-image">
                </div>
                <div class="step-item-gongtan">
                    <h3>名單公告 & 現場問事</h3>
                    <p>等待義工公告名單，並於公告時間兩小時內報到。</p>
                </div>
            </div>
        </div>
        
        <section class="declaration-section" style="margin-top: 80px;">
            <h2 class="section-title">帥府聲明</h2>
            <div class="declaration-box">
                <div class="declaration-text">
                    <ol>
                        <li>所有神務僅限「承天中承府」元帥娘或授權義工執行。</li>
                        <li>欲靜心感受承天中承府之氣場，請於最前方桌前就座。</li>
                        <li>請勿直接透過社群媒體聯繫元帥娘或要求立即處理相關事宜。</li>
                    </ol>
                </div>
                <img class="declaration-avatar" src="{{ url_for('static', filename='images/common/declare-avator.png') }}" alt="聲明圖">
            </div>
        </section>
    </div>

    <div id="step-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeStepModal()">×</button>
            <h3 id="modal-title" style="margin-top:0; font-size:20px; color:#C48945;">標題</h3>
            <div id="modal-body" style="text-align:left; line-height:1.8;"></div>
        </div>
    </div>

</main>

<script>
// 點擊錨點平滑捲動 (修正被 Header 遮擋)
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
            const headerOffset = 180; // 預留 Header + 按鈕列的高度
            const elementPosition = targetElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            window.scrollTo({ top: offsetPosition, behavior: "smooth" });
        }
    });
});

// Modal 邏輯
const stepData = {
    1: { title: "步驟一：填寫紅紙", content: "<ol style='padding-left:20px;'><li>姓名</li><li>出生年月日 (註明國/農曆)</li><li>出生時辰 (寫吉時)</li><li>生肖</li><li>地址</li><li>填寫日期</li><li>備註 (需寄回請註明)</li></ol>" },
    2: { title: "步驟二：寄送資訊", content: "<p>收件人：八八菸酒</p><p>地址：嘉義市新生路337號</p>" },
    3: { title: "步驟三：黑貓教學", content: "<img src='{{ url_for('static', filename='images/pages/shoujing/shipping.jpg') }}' style='width:100%; border-radius:8px;'>" }
};
function openStepModal(idx) {
    const d = stepData[idx];
    document.getElementById('modal-title').innerHTML = d.title;
    document.getElementById('modal-body').innerHTML = d.content;
    document.getElementById('step-modal-overlay').style.display = 'flex';
}
function closeStepModal() { document.getElementById('step-modal-overlay').style.display = 'none'; }
document.getElementById('step-modal-overlay').onclick = (e) => { if(e.target.id === 'step-modal-overlay') closeStepModal(); };
</script>
{% endblock %}