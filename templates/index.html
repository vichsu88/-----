{% extends "base.html" %}

{% block title %}承天中承府 - 首頁{% endblock %}

{% block content %}
<style>
    /* === 1. 統一的元寶標題樣式 (您的核心需求) === */
    .yuanbao-title-box {
        display: flex; 
        justify-content: center; 
        align-items: center; 
        gap: 20px; /* 元寶跟字的距離 */
        margin-bottom: 30px;
        z-index: 2;
        position: relative;
    }
    
    .yuanbao-title-text {
        font-family: 'KouzanBrushFontOTF', serif; /* 書法體 */
        font-size: 2.5rem; /* ★ 尺寸加大，符合您原本的感覺 */
        color: #000 !important; /* ★ 強制純黑色 */
        margin: 0; 
        font-weight: bold;
        line-height: 1.2;
        text-shadow: none; /* 移除陰影，保持乾淨的黑色 */
    }
    
    .yuanbao-icon {
        width: 50px; /* 元寶圖片配合文字放大 */
        height: auto;
    }

    /* === 2. 服務項目區塊 === */
    .services-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        padding: 0 10px;
    }
    
    .service-item {
        position: relative;
        height: 480px; 
        border-radius: 20px;
        overflow: hidden;
        padding: 0; margin: 0; border: none;
        background: #000;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        transition: transform 0.4s ease, box-shadow 0.4s ease;
        -webkit-mask-image: -webkit-radial-gradient(white, black);
        will-change: transform;
    }
    
    .service-item:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(196, 137, 69, 0.4);
        z-index: 2;
    }

    .service-bg {
        width: 100%; height: 100%; object-fit: cover;
        transition: transform 0.8s ease; display: block;
        will-change: transform;
    }

    .service-item:hover .service-bg { transform: scale(1.1); }

    .service-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%);
        display: flex; justify-content: center; align-items: center; z-index: 2;
    }

    .service-buttons {
        display: flex; flex-direction: column; gap: 15px;
        width: 100%; max-width: 260px;
    }
    
    .btn-grid-2x2 {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 320px;
    }

    /* 按鈕樣式 */
    .glow-btn {
        position: relative; display: flex; justify-content: center; align-items: center;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.9);
        color: #5a3a1a; padding: 15px 10px; border-radius: 50px;
        text-decoration: none; font-weight: 900; font-size: 1.15rem; letter-spacing: 1px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        animation: pulse-glow 3s infinite ease-in-out;
        will-change: transform, box-shadow;
    }

    .glow-btn:hover {
        background: #fff; color: #C48945; transform: scale(1.05);
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.7); border-color: #C48945;
    }

    @keyframes pulse-glow {
        0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
        50% { box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.5); border-color: #ffd700; }
        100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
    }

    .service-buttons .glow-btn:nth-child(1) { animation-delay: 0s; }
    .service-buttons .glow-btn:nth-child(2) { animation-delay: 0.5s; }
    .service-buttons .glow-btn:nth-child(3) { animation-delay: 1.0s; }
    .service-buttons .glow-btn:nth-child(4) { animation-delay: 1.5s; }

    /* === 3. 最新消息區塊 === */
    .news-section { margin-top: 40px; }

    .news-card {
        display: flex;
        flex-direction: column;
        padding: 20px 30px;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        border: 1px solid #eee;
        position: relative;
        min-height: 200px;
        overflow: visible;
    }

    /* 排版設定 */
    .news-content-wrapper {
        display: flex; 
        align-items: flex-start; /* 電腦版：靠上對齊 */
        justify-content: space-between;
        position: relative; 
        flex: 1;
        gap: 20px;
    }

    /* 滑動視窗設定 */
    .news-window {
        flex: 1; 
        position: relative;
        margin-right: 0; 
        height: 350px; /* 固定高度 */
        overflow-y: auto; /* 開啟垂直捲軸 */
        padding-right: 10px;
    }

    /* 捲軸美化 */
    .news-window::-webkit-scrollbar { width: 6px; }
    .news-window::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
    .news-window::-webkit-scrollbar-thumb { background: #C48945; border-radius: 3px; }
    .news-window::-webkit-scrollbar-thumb:hover { background: #a06d35; }

    .news-list {
        list-style: none; padding: 0; margin: 0; width: 100%;
    }

    /* 列表項目 */
    .news-list li {
        display: flex; 
        flex-direction: column; 
        align-items: flex-start;
        gap: 12px;
        cursor: pointer;
        padding: 15px 0;
        width: 100%;
        border-bottom: 1px dashed #ddd; /* 分隔線 */
    }
    
    .news-list li:last-child { border-bottom: none; }
    .news-list li:hover { background-color: #fafafa; }

    .news-meta {
        display: flex; align-items: center; gap: 10px; width: 100%; flex-wrap: wrap;
    }

    .news-date {
        background: #C48945; color: #fff; padding: 2px 8px; border-radius: 4px;
        font-size: 0.9rem; font-weight: bold; flex-shrink: 0;
    }
    
    .news-title {
        font-size: 1.3rem; color: #333; font-weight: bold;
        white-space: normal; line-height: 1.4;
    }

    .news-preview {
        font-size: 1.05rem; 
        color: #444; 
        line-height: 1.8;
        margin-top: 5px;
        width: 100%;
        display: block; 
        white-space: normal;
        word-wrap: break-word;
        text-align: left;
    }
    
    .news-avatar {
        width: 160px; height: auto;
        position: relative; 
        z-index: 10;
        animation: wobble 3s infinite ease-in-out;
        transform-origin: bottom center;
        filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        flex-shrink: 0; 
        will-change: transform;
    }
    
    @keyframes wobble {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
    }

    /* === 4. 其他樣式 === */
    .video-responsive-wrapper {
        position: relative; padding-bottom: 56.25%; height: 0; width: 100%;
        max-width: 1200px; margin: 0 auto 40px auto;
        border-radius: 15px; overflow: hidden;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .video-responsive-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
    .reveal.active { opacity: 1; transform: translateY(0); }

    /* === 5. RWD 手機版調整 === */
    @media (max-width: 768px) {
        /* 手機版標題稍微縮小一點點，避免換行 */
        .yuanbao-title-text { font-size: 2rem; }
        .yuanbao-icon { width: 35px; }

        .services-grid { grid-template-columns: 1fr; }
        .service-item { height: 400px; }
        
        .news-card {
            margin-top: 40px; 
            padding: 20px 15px;
            height: auto; 
            min-height: 160px;
        }
        
        .news-content-wrapper { 
            flex-direction: column; 
            align-items: stretch;
        }
        
        .news-window { 
            width: 100%; 
            height: 400px; 
            margin-bottom: 15px;
        }
        
        .news-list li { gap: 10px; padding: 12px 0; }

        .news-meta {
            flex-direction: row; 
            align-items: flex-start;
            gap: 8px;
        }
        
        .news-title { 
            font-size: 1.2rem;
        }

        .news-preview {
            font-size: 1rem;
        }
        
        .news-avatar {
            width: 110px; 
            margin-left: 0;
            align-self: flex-end; 
        }
    }
</style>

    <div id="intro-overlay" class="reveal">
        <img src="{{ url_for('static', filename='images/pages/index/banner.png') }}" 
             alt="承天中承府眾神" 
             fetchpriority="high" 
             loading="eager">
    </div>

    <section class="hero-section" aria-label="承天中承府主視覺"></section>

    <section class="news-section reveal">
        <div class="news-card">
            <div class="yuanbao-title-box">
                <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
                <h3 class="yuanbao-title-text">最新消息</h3>
                <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
            </div>
            
            <div class="news-content-wrapper">
                <div class="news-window">
                    <ul class="news-list" id="news-list">
                        <li>載入中...</li>
                    </ul>
                </div>
                <img class="news-avatar" src="{{ url_for('static', filename='images/pages/index/news-avator.png') }}" alt="小編報報">
            </div>
        </div>
    </section>

    <section class="about-section reveal">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">關於帥府</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>
        
        <div class="video-responsive-wrapper">
            <iframe src="https://www.youtube.com/embed/odpTDkvJBpw?autoplay=1&mute=1&loop=1&playlist=odpTDkvJBpw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div >
        
        <div class="photo-gallery activity-gallery">
            <img src="{{ url_for('static', filename='images/pages/index/activity1.jpg') }}" alt="活動照片1" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity2.jpg') }}" alt="活動照片2" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity3.jpg') }}" alt="活動照片3" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity4.jpg') }}" alt="活動照片4" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity5.jpg') }}" alt="活動照片5" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity6.jpg') }}" alt="活動照片6" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity7.jpg') }}" alt="活動照片7" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity8.jpg') }}" alt="活動照片8" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity9.jpg') }}" alt="活動照片9" loading="lazy">
        </div>
        
        <div class="deity-list-no-shrine">
            <p>承天中承府座落於嘉義市東區新生路，主祀「煙島中壇元帥」。</p>
            <p>元帥儀表堂堂、性格正直爽朗，故稱為「煙島」。象徵其獨特非凡、天上地下難得一見之神威風采。</p>
            <p>府內供奉神明：</p>
        </div>
        
        <div class="deity-carousel">
            <div class="deity-grid-track">
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god0.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">承天中承府</p><p class="deity-name">煙島元帥</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god1.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">花蓮勝安宮</p><p class="deity-name">王母娘娘</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god2.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">埔里寶湖宮</p><p class="deity-name">地母至尊</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god3.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">朴子配天宮</p><p class="deity-name">天上聖母</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god4.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">梅山玉<span class="font-fallback">虛</span>宮</p><p class="deity-name">玄天上帝</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god5.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">嘉義文財殿</p><p class="deity-name">文財神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god6.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">北港武德宮</p><p class="deity-name">武財神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god7.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">四湖參天宮</p><p class="deity-name">關聖帝君</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god8.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">世賢路福德宮</p><p class="deity-name">福德正神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god9.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">朴子配天宮</p><p class="deity-name">山軍尊神（虎爺）</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god0.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">承天中承府</p><p class="deity-name">煙島元帥</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god1.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">花蓮勝安宮</p><p class="deity-name">王母娘娘</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god2.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">埔里寶湖宮</p><p class="deity-name">地母至尊</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god3.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name">朴子配天宮</p><p class="deity-name">天上聖母</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god4.jpg') }}" loading="lazy"><div class="deity-info"><p class="temple-name"> 梅山玉<span class="font-fallback">虛</span>宮</p><p class="deity-name">玄天上帝</p></div></div>
            </div>
        </div>
    </section>
    
    <section class="services-section reveal" id="services-section">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">服務項目</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>

        <div class="services-grid">
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon1.png') }}" alt="濟世服務">
                <div class="service-overlay">
                    <div class="service-buttons btn-grid-2x2">
                        <a href="{{ url_for('services_page') }}" class="glow-btn">問事收驚</a>
                        <a href="{{ url_for('ship_clothes_page') }}" class="glow-btn">衣物寄回</a>
                        <a href="{{ url_for('donation_page') }}" class="glow-btn">捐香服務</a>
                        <a href="{{ url_for('feedback_page') }}" class="glow-btn">信徒回饋</a>
                    </div>
                </div>
            </div>
            
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon2.png') }}" alt="結緣品">
                <div class="service-overlay">
                    <div class="service-buttons">
                        <a href="{{ url_for('shop_page') }}" class="glow-btn">帥府周邊</a>
                        <a href="{{ links['手工香賣場'] or '#' }}" class="glow-btn" target="_blank">蝦皮賣場</a>
                    </div>
                </div>
            </div>
            
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon3.jpg') }}" alt="建廟基金">
                <div class="service-overlay">
                    <div class="service-buttons">
                        <a href="{{ url_for('fund_page') }}" class="glow-btn">建廟護持</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="declaration-section reveal">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">帥府聲明</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>

        <div class="declaration-box">
            <div class="declaration-text">
                <ol>
                    <li>1. 神務僅限「承天中承府」元帥娘或授權義工執行，其餘對外神務請小心求證，避免受騙上當。</li>
                    <li>2. 進府請注意禮儀，使用椅子於桌前就座，請勿靠近神桌、神尊，或席地而坐。</li>
                    <li>3. 任何需求請親臨帥府參拜，向元帥稟告祈求，請勿透過IG、臉書或其他社群媒體直接聯繫元帥娘要求立即處理問事。</li>
                </ol>
            </div>
            <img class="declaration-avatar" src="{{ url_for('static', filename='images/common/declare-avator.png') }}" alt="帥府聲明代表圖">
        </div>
    </section>

    <div class="announcement-modal" id="announcementModal">
        <div class="modal-content">
            <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
            <div class="modal-date" id="modalDate"></div>
            <h3 class="modal-title" id="modalTitle"></h3>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. 載入公告
            fetch('/api/announcements')
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById('news-list');
                    if(data.length === 0) { list.innerHTML = '<li>尚無最新公告</li>'; return; }
                    
                    // 改為直接列出所有資料，無輪播
                    list.innerHTML = data.map((news) => {
                        const contentText = news.content || news.description || '';
                        
                        return `
                        <li onclick='showNews(${JSON.stringify(news)})'>
                            <div class="news-meta">
                                <span class="news-date">${news.date}</span>
                                <span class="news-title">${news.title} ${news.isPinned ? '<span class="pinned-badge">置頂</span>' : ''}</span>
                            </div>
                            <div class="news-preview">
                                ${contentText.replace(/\n/g, '<br>')} 
                            </div>
                        </li>
                    `}).join('');
                });

            // 2. Modal
            const modal = document.getElementById('announcementModal');
            const closeBtn = document.getElementById('modalCloseBtn');
            window.showNews = (news) => {
                document.getElementById('modalDate').textContent = news.date;
                document.getElementById('modalTitle').textContent = news.title;
                const content = news.content || news.description || '';
                document.getElementById('modalBody').innerHTML = content.replace(/\n/g, '<br>');
                modal.classList.add('show');
            };
            closeBtn.onclick = () => modal.classList.remove('show');
            window.onclick = (e) => { if(e.target === modal) modal.classList.remove('show'); };

            // 3. 特效
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, { threshold: 0.05, rootMargin: "0px 0px -50px 0px" }); 
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        });
    </script>

{% endblock %}