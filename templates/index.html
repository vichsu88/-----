{% extends "base.html" %}

{% block title %}承天中承府 - 嘉義中壇煙島元帥 | 免費收驚問事、補財庫{% endblock %}

{% block content %}

{# --- CSS 優化區：使用變數與模組化結構 --- #}
<style>
    :root {
        --primary-gold: #C48945;
        --primary-gold-hover: #a06d35;
        --text-dark: #333;
        --text-gray: #444;
        --bg-light: #f9f9f9;
        --border-color: #eee;
        --shadow-sm: 0 5px 15px rgba(0,0,0,0.05);
        --shadow-md: 0 10px 25px rgba(0,0,0,0.15);
        --transition-base: all 0.3s ease;
    }

    /* =========================================
       1. 共用工具類 (Utilities & Animations)
       ========================================= */
    .visually-hidden {
        position: absolute; width: 1px; height: 1px; 
        overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap;
    }

    .reveal { 
        opacity: 0; transform: translateY(30px); 
        transition: transform 0.8s ease-out, opacity 0.8s ease-out; 
    }
    .reveal.active { opacity: 1; transform: translateY(0); }

    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
        50% { box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.5); border-color: #ffd700; }
    }

    @keyframes wobble {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
    }

    /* =========================================
       2. 元件樣式 (Components)
       ========================================= */
    /* 元寶標題 */
    .yuanbao-title-box {
        display: flex; justify-content: center; align-items: center; 
        gap: 20px; margin-bottom: 30px; z-index: 2; position: relative;
    }
    .yuanbao-title-text {
        font-family: 'LXGW WenKai TC', serif; font-size: 2.5rem; 
        color: #000; margin: 0; font-weight: bold; line-height: 1.2;
    }
    .yuanbao-icon { width: 50px; height: auto; }

    /* 發光按鈕 */
    .glow-btn {
        position: relative; display: flex; justify-content: center; align-items: center;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.9);
        color: #5a3a1a; padding: 15px 10px; border-radius: 50px;
        text-decoration: none; font-weight: 900; font-size: 1.15rem; letter-spacing: 1px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: var(--transition-base);
        animation: pulse-glow 3s infinite ease-in-out;
        will-change: transform, box-shadow;
    }
    .glow-btn:hover {
        background: #fff; color: var(--primary-gold); transform: scale(1.05);
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.7); border-color: var(--primary-gold);
    }
    .service-buttons .glow-btn:nth-child(1) { animation-delay: 0s; }
    .service-buttons .glow-btn:nth-child(2) { animation-delay: 0.5s; }
    .service-buttons .glow-btn:nth-child(3) { animation-delay: 1.0s; }
    .service-buttons .glow-btn:nth-child(4) { animation-delay: 1.5s; }

    /* 影片容器 */
    .video-responsive-wrapper {
        position: relative; padding-bottom: 56.25%; height: 0; width: 100%;
        max-width: 1200px; margin: 0 auto 40px auto;
        border-radius: 15px; overflow: hidden;
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .video-responsive-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    /* =========================================
       3. 區塊樣式 (Sections)
       ========================================= */
    .hero-section { background-color: transparent; }

    /* 最新消息 */
    .news-section { margin-top: 40px; }
    .news-card {
        display: flex; flex-direction: column; padding: 20px 30px;
        background: #fff; border-radius: 15px; border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm); position: relative;
        min-height: 200px; max-width: 1200px; margin: 0 auto; overflow: visible;
    }
    .news-content-wrapper {
        display: flex; align-items: flex-start; justify-content: space-between;
        position: relative; flex: 1; gap: 20px;
    }
    .news-window {
        flex: 1; position: relative; height: 350px; overflow-y: auto; padding-right: 10px;
    }
    .news-window::-webkit-scrollbar { width: 6px; }
    .news-window::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
    .news-window::-webkit-scrollbar-thumb { background: var(--primary-gold); border-radius: 3px; }
    .news-window::-webkit-scrollbar-thumb:hover { background: var(--primary-gold-hover); }

    .news-list { list-style: none; padding: 0; margin: 0; width: 100%; }
    .news-list li {
        display: flex; flex-direction: column; align-items: flex-start; gap: 12px;
        cursor: pointer; padding: 15px 0; width: 100%;
        border-bottom: 1px dashed #ddd; transition: background-color 0.2s;
    }
    .news-list li:last-child { border-bottom: none; }
    .news-list li:hover { background-color: #fafafa; }

    .news-meta { display: flex; align-items: center; gap: 10px; width: 100%; flex-wrap: wrap; }
    .news-date {
        background: var(--primary-gold); color: #fff; padding: 2px 8px; border-radius: 4px;
        font-size: 0.9rem; font-weight: bold; flex-shrink: 0;
    }
    .news-title {
        font-size: 1.3rem; color: var(--text-dark); font-weight: bold;
        line-height: 1.4;
    }
    .pinned-badge {
        background: #d9534f; color: white; font-size: 0.8rem; padding: 2px 6px;
        border-radius: 4px; margin-left: 8px; vertical-align: middle;
    }
    .news-preview {
        font-size: 1.05rem; color: var(--text-gray); line-height: 1.8; margin-top: 5px;
        width: 100%; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        overflow: hidden; word-wrap: break-word;
    }
    .news-avatar {
        width: 160px; height: auto; position: relative; z-index: 10; flex-shrink: 0;
        animation: wobble 3s infinite ease-in-out; transform-origin: bottom center;
        filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); will-change: transform;
    }

    /* 服務項目 Grid */
    .services-grid {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px; padding: 0 10px; max-width: 1200px; margin: 0 auto;
    }
    .service-item {
        position: relative; height: 480px; border-radius: 20px; overflow: hidden;
        background: #000; box-shadow: var(--shadow-md);
        transition: transform 0.4s ease, box-shadow 0.4s ease;
        -webkit-mask-image: -webkit-radial-gradient(white, black);
        will-change: transform;
    }
    .service-item:hover {
        transform: translateY(-10px); z-index: 2;
        box-shadow: 0 20px 40px rgba(196, 137, 69, 0.4);
    }
    .service-bg {
        width: 100%; height: 100%; object-fit: cover; display: block;
        transition: transform 0.8s ease; will-change: transform;
    }
    .service-item:hover .service-bg { transform: scale(1.1); }
    
    .service-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%);
        display: flex; justify-content: center; align-items: center; z-index: 2;
    }
    .service-buttons {
        display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 260px;
    }
    .btn-grid-2x2 {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 320px;
    }

    /* =========================================
       4. RWD 手機版優化
       ========================================= */
    @media (max-width: 768px) {
        .yuanbao-title-text { font-size: 2rem; }
        .yuanbao-icon { width: 35px; }
        
        /* 服務區塊調整 */
        .services-grid { grid-template-columns: 1fr; }
        .service-item { height: 400px; }
        
        /* 最新消息調整 */
        .news-card {
            margin-top: 40px; padding: 20px 15px; height: auto; min-height: 160px;
        }
        .news-content-wrapper { flex-direction: column; align-items: stretch; }
        .news-window { width: 100%; height: 400px; margin-bottom: 15px; }
        .news-list li { gap: 10px; padding: 12px 0; }
        .news-meta { flex-direction: row; align-items: flex-start; gap: 8px; }
        .news-title { font-size: 1.2rem; }
        .news-preview { font-size: 1rem; }
        .news-avatar {
            width: 110px; margin-left: 0; align-self: flex-end;
        }
    }
</style>

    {# --- SEO 隱藏標題 --- #}
    <h1 class="visually-hidden">
        承天中承府 - 嘉義中壇煙島元帥 | 免費收驚問事、補財庫、點龍柱與公司招財科儀
    </h1>

    <div id="intro-overlay" class="reveal">
        <img src="{{ url_for('static', filename='images/pages/index/banner.png') }}" 
             alt="承天中承府眾神-中壇元帥與眾神尊" 
             fetchpriority="high" 
             loading="eager">
    </div>

    <section class="hero-section" aria-label="承天中承府主視覺">
        <img src="{{ url_for('static', filename='images/pages/index/banner_PC.jpg') }}" 
             alt="承天中承府眾神-中壇元帥與眾神尊" 
             fetchpriority="high" 
             loading="eager">
    </section>

    <section class="news-section reveal">
        <div class="news-card">
            <div class="yuanbao-title-box">
                <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
                <h3 class="yuanbao-title-text">最新消息</h3>
                <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
            </div>
            
            <div class="news-content-wrapper">
                <div class="news-window">
                    {# 使用 data attribute 存儲資料，移除 inline onclick #}
                    <ul class="news-list" id="news-list">
                        {% if announcements %}
                            {% for news in announcements %}
                            <li class="news-item" data-news="{{ news | tojson | forceescape }}">
                                <div class="news-meta">
                                    <span class="news-date">{{ news.date }}</span>
                                    <span class="news-title">
                                        {{ news.title }} 
                                        {% if news.isPinned %}
                                        <span class="pinned-badge">置頂</span>
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="news-preview">
                                    {{ (news.content or '') | striptags | truncate(60) }}
                                </div>
                            </li>
                            {% endfor %}
                        {% else %}
                            <li>尚無最新公告，歡迎隨時關注帥府動態。</li>
                        {% endif %}
                    </ul>
                </div>
                <img class="news-avatar" src="{{ url_for('static', filename='images/pages/index/news-avator.png') }}" alt="帥府小編報報">
            </div>
        </div>
    </section>

    <section class="about-section reveal">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">關於帥府</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>
        
        <div class="video-responsive-wrapper">
            <iframe src="https://www.youtube.com/embed/odpTDkvJBpw?autoplay=1&mute=1&loop=1&playlist=odpTDkvJBpw" title="承天中承府-中壇元帥紀錄片" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div >
        
        <div class="photo-gallery activity-gallery">
            <img src="{{ url_for('static', filename='images/pages/index/activity1.jpg') }}" alt="承天中承府-中壇煙島元帥聖誕祝壽大典" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity2.jpg') }}" alt="嘉義免費收驚問事-信徒虔誠參拜現場" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity3.jpg') }}" alt="承天中承府進香活動-傳統信仰與文化傳承" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity4.jpg') }}" alt="元帥娘發願濟世-癌症祈福與神蹟見證" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity5.jpg') }}" alt="承天中承府公益活動-關懷社會弱勢" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity6.jpg') }}" alt="嘉義補財庫推薦-公司行號招財科儀" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity7.jpg') }}" alt="點龍柱祈福法會-祈求元帥庇佑闔家平安" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity8.jpg') }}" alt="煙島元帥指定供品-金莎巧克力與奧利多水" loading="lazy">
            <img src="{{ url_for('static', filename='images/pages/index/activity9.jpg') }}" alt="承天中承府-嘉義市東區新生路337號參拜人潮" loading="lazy">
        </div>
        
        <div class="deity-list-no-shrine">
            <p>承天中承府座落於嘉義市東區，主祀「煙島中壇元帥」。元帥性格正直爽朗、儀表堂堂，故稱「煙島」。</p>
            <p>本府辦事十年來堅持「免費收驚、免費問事」，緣起於元帥娘感念元帥護佑癌症末期父親延壽三年的神蹟，因而發願濟世。除靈驗的濟世服務外，亦提供補財庫、點龍柱、法會及公司行號招財科儀。</p>
            <p>元帥特別喜愛金莎巧克力與奧利多水，展現獨特親民的神威風采。歡迎十方善信蒞臨參拜，祈求平安與財運。</p>
            <p style="margin-top: 15px; font-weight: bold; color: var(--primary-gold);">府內供奉神明：</p>
        </div>
        
        <div class="deity-carousel">
            <div class="deity-grid-track">
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god0.jpg') }}" alt="承天中承府-中壇煙島元帥神尊" loading="lazy"><div class="deity-info"><p class="temple-name">承天中承府</p><p class="deity-name">煙島元帥</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god1.jpg') }}" alt="陪祀神明-王母娘娘" loading="lazy"><div class="deity-info"><p class="temple-name">花蓮勝安宮</p><p class="deity-name">王母娘娘</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god2.jpg') }}" alt="陪祀神明-地母至尊" loading="lazy"><div class="deity-info"><p class="temple-name">埔里寶湖宮</p><p class="deity-name">地母至尊</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god3.jpg') }}" alt="陪祀神明-天上聖母" loading="lazy"><div class="deity-info"><p class="temple-name">朴子配天宮</p><p class="deity-name">天上聖母</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god4.jpg') }}" alt="陪祀神明-玄天上帝" loading="lazy"><div class="deity-info"><p class="temple-name">梅山玉虛宮</p><p class="deity-name">玄天上帝</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god5.jpg') }}" alt="陪祀神明-文財神" loading="lazy"><div class="deity-info"><p class="temple-name">嘉義文財殿</p><p class="deity-name">文財神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god6.jpg') }}" alt="陪祀神明-武財神" loading="lazy"><div class="deity-info"><p class="temple-name">北港武德宮</p><p class="deity-name">武財神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god7.jpg') }}" alt="陪祀神明-關聖帝君" loading="lazy"><div class="deity-info"><p class="temple-name">四湖參天宮</p><p class="deity-name">關聖帝君</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god8.jpg') }}" alt="陪祀神明-福德正神" loading="lazy"><div class="deity-info"><p class="temple-name">世賢路福德宮</p><p class="deity-name">福德正神</p></div></div>
                <div class="deity-card"><img src="{{ url_for('static', filename='images/pages/index/god9.jpg') }}" alt="陪祀神明-山軍尊神(虎爺)" loading="lazy"><div class="deity-info"><p class="temple-name">朴子配天宮</p><p class="deity-name">山軍尊神（虎爺）</p></div></div>
            </div>
        </div>
    </section>
    
    <section class="services-section reveal" id="services-section">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">服務項目</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>

        <div class="services-grid">
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon1.png') }}" alt="承天中承府-問事收驚服務">
                <div class="service-overlay">
                    <div class="service-buttons btn-grid-2x2">
                        <a href="{{ url_for('services_page') }}" class="glow-btn">問事收驚</a>
                        <a href="{{ url_for('ship_clothes_page') }}" class="glow-btn">衣物寄回</a>
                        <a href="{{ url_for('donation_page') }}" class="glow-btn">捐香服務</a>
                        <a href="{{ url_for('feedback_page') }}" class="glow-btn">信徒回饋</a>
                    </div>
                </div>
            </div>
            
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon2.png') }}" alt="承天中承府-結緣品與賣場">
                <div class="service-overlay">
                    <div class="service-buttons">
                        <a href="{{ url_for('shop_page') }}" class="glow-btn">帥府賣場</a>
                        <a href="{{ links['手工香賣場'] or '#' }}" class="glow-btn" target="_blank">賣貨便</a>
                    </div>
                </div>
            </div>
            
            <div class="service-item">
                <img class="service-bg" src="{{ url_for('static', filename='images/pages/index/service-icon3.png') }}" alt="承天中承府-建廟護持">
                <div class="service-overlay">
                    <div class="service-buttons">
                        <a href="{{ url_for('fund_page') }}" class="glow-btn">建廟護持</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="declaration-section reveal">
        <div class="yuanbao-title-box">
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-left.png') }}" class="yuanbao-icon" alt="元寶">
            <h2 class="yuanbao-title-text">帥府聲明</h2>
            <img src="{{ url_for('static', filename='images/pages/index/title-yuanbao-right.png') }}" class="yuanbao-icon" alt="元寶">
        </div>

        <div class="declaration-box">
            <div class="declaration-text">
                <ol>
                    <li>1. 神務僅限「承天中承府」元帥娘或授權義工執行，其餘對外神務請小心求證，避免受騙上當。</li>
                    <li>2. 進府請注意禮儀，使用椅子於桌前就座，請勿靠近神桌、神尊，或席地而坐。</li>
                    <li>3. 任何需求請親臨帥府參拜，向元帥稟告祈求，請勿透過IG、臉書或其他社群媒體直接聯繫元帥娘要求立即處理問事。</li>
                </ol>
            </div>
            <img class="declaration-avatar" src="{{ url_for('static', filename='images/common/declare-avator.png') }}" alt="帥府聲明代表圖">
        </div>
    </section>

    <div class="announcement-modal" id="announcementModal">
        <div class="modal-content">
            <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
            <div class="modal-date" id="modalDate"></div>
            <h3 class="modal-title" id="modalTitle"></h3>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('announcementModal');
            const closeBtn = document.getElementById('modalCloseBtn');
            const newsList = document.getElementById('news-list');
            
            // 顯示公告函式
            const showNews = (news) => {
                document.getElementById('modalDate').textContent = news.date;
                document.getElementById('modalTitle').textContent = news.title;
                const content = news.content || news.description || '';
                document.getElementById('modalBody').innerHTML = content.replace(/\n/g, '<br>');
                modal.classList.add('show');
            };
            
            // 事件委派：監聽整個列表，而非每個項目，效能更佳
            if (newsList) {
                newsList.addEventListener('click', (e) => {
                    const item = e.target.closest('.news-item');
                    if (item && item.dataset.news) {
                        showNews(JSON.parse(item.dataset.news));
                    }
                });
            }
            
            // Modal 關閉邏輯
            closeBtn.onclick = () => modal.classList.remove('show');
            window.onclick = (e) => { if(e.target === modal) modal.classList.remove('show'); };

            // 捲動顯現特效 (IntersectionObserver)
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        observer.unobserve(entry.target); // 動畫觸發後停止觀察，節省資源
                    }
                });
            }, { threshold: 0.05, rootMargin: "0px 0px -50px 0px" }); 
            
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        });
    </script>

{% endblock %}